<html xmlns:th="https://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout (~{::body},'albums')}">

<head>
</head>
<body>

<div class="album-main">

  <a th:href="${currentUrl}" style="color:blue;">
    <h3><- Return to shopping</h3>
  </a>
  <div class="centerstage">
    <div class="techfont stage" id="div_centrestage">
      <div class="row" style="display:flex; justify-content:center; vertical-align:middle;">
        <p>
        <h1>
          Cart
        </h1>
        <table><tr><td>
          <table>
            <tr th:each="item : ${items}">
              <td th:text="${item.picture.id}" style="padding:5px;">
                  Item
              </td>
              <td style="padding:5px;">
                <a th:href="@{/collection/__${item.picture.id}__}">
                  <img th:width="${item.picture.displayWidth / 2}"
                       th:height="${item.picture.displayHeight / 2}"
                       th:src="${item.picture.mediumFilename}"
                       th:data-src="${item.picture.mediumFilename}"
                       th:alt="${item.picture.title}"
                  >
                </a>
              </td>
              <td th:for="${item.pricingTier.name()}"
                     th:if="${item.pricingTier.height} != -1"
                     th:text="${item.pricingTier.name() + ' (' +
                 #numbers.formatDecimal(
                     (item.pricingTier.height * (item.picture.aspectRatio ?: 0)),
                     1, 0
                 ) +
                 ' x ' + item.pricingTier.height + ') '}"
                  style="padding:5px;">
              </td>
              <td th:for="${item.pricingTier.name()}"
                     th:if="${item.pricingTier.height} == -1"
                     th:text="${item.pricingTier.name() + ' (' + item.picture.width +  ' x ' + item.picture.height + ') '}"
                  style="padding:5px;">
              </td>
              <td style="padding:5px;">
                <form action="/cart/delete" method="post" style="display:inline">
                  <button type="submit" style="background-color:rgba(0,0,0,0); border:none;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <input type="hidden" name="redirectTo" th:value="${currentUrl}" />
                    <input type="hidden" name="orderNo" th:value="${item.id}" />
                     <svg xmlns="http://www.w3.org/2000/svg"
                          height="32" width="32"
                          viewBox="0 96 960 960"
                          fill="var(--homepix-br-darkest)">
                      <path d="M280 936q-33 0-56.5-23.5T200 856V336h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680 936H280Zm400-600H280v520h400V336ZM400 776h80V416h-80v360Zm160 0h80V416h-80v360Z"/>
                    </svg>
                  </button>
                </form>
              </td>
              <td th:text="${#numbers.formatDecimal(item?.getTotalPrice() ?: 0, 1, 2) + ' CHF'}" style="padding:5px;">
                10.00
              </td>
            </tr>
          </table>
        </td>
        <td style="padding-left:25px;">
            <th:block th:if="${price > 0}">
            <p>Total:</p>
            <p th:text="${#numbers.formatDecimal(price, 1, 2)}">100,000 CHF</p>
            <hr>
            <form action="/cart/buy" method="post">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
              <button class="mdc-button mdc-button--raised" type="submit">
                <span class="mdc-button__label">Buy</span>
              </button>
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            </form>
          </th:block>
          <p>Downloads available:</p>
          <th:block th:each="download : ${downloads}">
            <form th:action="${download.downloadUrl}" method="get" style="display:inline">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
              <input type="hidden" name="orderNo" th:value="${download.orderNo}" />
              <button class="mdc-button mdc-button--raised"
                      th:classappend="${download.downloadedAt != null} ? 'downloaded' : 'not-downloaded'"
                      th:title="${download.downloadedAt != null}
                        ? 'Downloaded at ' + ${#temporals.format(download.downloadedAt, 'yyyy-MM-dd HH:mm')}
                        : 'Not downloaded yet'"
                      th:style="${download.downloadedAt != null}
                        ? 'background-color:#2e7d32'
                        : 'background-color:var(--homepix-dark)'"
                      type="submit">
                <svg xmlns="http://www.w3.org/2000/svg"
                     height="20" width="20"
                     viewBox="0 0 24 24" fill="var(--homepix-br-lightest)">
                  <path d="M5 20q-.825 0-1.412-.587Q3 18.825 3 18v-3h2v3h14v-3h2v3q0 .825-.587 1.413Q19.825 20 19 20Zm7-4L7.4 11.4 8.825 10l2.175 2.175V4h2v8.175L15.2 10l1.4 1.4Z"/>
                </svg>
                <span class="mdc-button__label"
                      th:text="${download.filename}">
                </span>
              </button>
            </form>
            <br>
            <br>
          </th:block>
      </td></tr></table>
    </div>
  </div>
</div>

</body>

</html>
