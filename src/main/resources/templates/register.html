<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Register | HomePIX</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-100">

<div class="w-full max-w-md p-6 bg-white rounded-lg shadow-md">
  <h2 class="text-2xl font-semibold text-center text-gray-700 mb-6">Create Account</h2>

  <form id="registrationForm" action="/register" method="post" novalidate>
    <!-- Username -->
    <div class="mb-4">
      <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
      <input type="text" id="username" name="username" required
             class="w-full px-4 py-2 mt-1 border rounded-lg focus:ring focus:ring-blue-300">
    </div>

    <!-- Email -->
    <div class="mb-4">
      <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
      <input type="email" id="email" name="email" required
             class="w-full px-4 py-2 mt-1 border rounded-lg focus:ring focus:ring-blue-300">
    </div>

    <!-- Password Mismatch Error -->
    <div id="badEMail" class="hidden text-red-600 text-sm mb-4">
      E-mail is invalid
    </div>

    <!-- Password -->
    <div class="mb-4">
      <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
      <input type="password" id="password" name="password" required
             class="w-full px-4 py-2 mt-1 border rounded-lg focus:ring focus:ring-blue-300">
    </div>

    <!-- Confirm Password -->
    <div class="mb-2">
      <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Confirm Password</label>
      <input type="password" id="confirmPassword" name="confirmPassword" required
             class="w-full px-4 py-2 mt-1 border rounded-lg focus:ring focus:ring-blue-300">
    </div>

    <!-- Password Mismatch Error -->
    <div id="passwordMismatch" class="hidden text-red-600 text-sm mb-4">
      Passwords do not match.
    </div>

    <!-- Submit -->
    <button id="submitBtn" type="submit"
            class="w-full px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring">
      Register
    </button>
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    <input type="hidden" name="redirectTo" th:value="${currentUrl}" />
  </form>
</div>

<script>
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirmPassword');
    const mismatchMessage = document.getElementById('passwordMismatch');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('registrationForm');
    const email = document.getElementById('email');
    const emailError = document.getElementById('badEMail');

    function checkPasswordsMatch() {
        const match = password.value === confirmPassword.value;
        mismatchMessage.classList.toggle('hidden', match);
        submitBtn.disabled = !match;
    }

    password.addEventListener('input', checkPasswordsMatch);
    confirmPassword.addEventListener('input', checkPasswordsMatch);
    email.addEventListener('input', validateEmailField);

    // Optional: prevent submission if JS disabled
    form.addEventListener('submit', (e) => {
        if (password.value !== confirmPassword.value) {
            e.preventDefault();
            mismatchMessage.classList.remove('hidden');
            submitBtn.disabled = true;
        }
    });

    function validateEmailField() {
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const isValid = emailPattern.test(email.value);

        if (!isValid && email.value !== "") {
            emailError.classList.remove('hidden');
        } else {
            emailError.classList.add('hidden');
        }

        return isValid;
    }

</script>

</body>
</html>
